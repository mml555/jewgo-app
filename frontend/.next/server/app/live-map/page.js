(()=>{var e={};e.id=4773,e.ids=[4773],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},76907:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c}),a(23245),a(11506),a(35866);var s=a(23191),r=a(88716),n=a(37922),l=a.n(n),i=a(95231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);a.d(t,o);let c=["",{children:["live-map",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,23245)),"/Users/mendell/jewgo app/frontend/app/live-map/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,11506)),"/Users/mendell/jewgo app/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/mendell/jewgo app/frontend/app/live-map/page.tsx"],u="/live-map/page",m={require:a,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/live-map/page",pathname:"/live-map",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},65038:(e,t,a)=>{Promise.resolve().then(a.bind(a,2373))},2373:(e,t,a)=>{"use strict";a.d(t,{default:()=>k});var s=a(10326),r=a(17577),n=a(35047),l=a(96968),i=a(93681),o=a(70540),c=a(77867);function d({restaurants:e,onRestaurantSelect:t,selectedRestaurantId:a,userLocation:n,mapCenter:l,className:i="h-96"}){let[o,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null),[h,g]=(0,r.useState)(null),x=(0,r.useRef)(null),p=(0,r.useRef)(null);(0,r.useRef)([]),(0,r.useRef)(null),(0,r.useRef)(null);let[y,b]=(0,r.useState)(!1),f=(0,c.qP)(e,e=>{if(!e.latitude||!e.longitude)return!1;let t=parseFloat(e.latitude.toString()),a=parseFloat(e.longitude.toString());return!isNaN(t)&&!isNaN(a)});return(console.log("InteractiveRestaurantMap Debug:",{totalRestaurants:e.length,restaurantsWithCoords:f.length,userLocation:!!n,mapCenter:!!l}),y||u)?u?s.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${i}`,children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"text-red-500 text-4xl mb-4",children:"⚠️"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Map Error"}),s.jsx("p",{className:"text-gray-600 mb-4",children:u})]})}):0===f.length?s.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${i}`,children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"\uD83D\uDDFA️"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No Location Data"}),s.jsx("p",{className:"text-gray-600",children:"No restaurants with location data available"})]})}):(0,s.jsxs)("div",{className:`relative bg-white rounded-lg shadow-lg overflow-hidden ${i}`,children:[s.jsx("div",{ref:x,className:"w-full h-full"}),s.jsx("div",{className:"absolute bottom-4 left-4 bg-white/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg",children:(0,s.jsxs)("div",{className:"text-xs font-medium text-gray-700",children:[f.length," restaurants",n&&s.jsx("span",{className:"text-blue-600 ml-2",children:"\uD83D\uDCCD Your location"})]})}),(0,s.jsxs)("div",{className:"absolute top-4 left-4 bg-white/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg",children:[s.jsx("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Kosher Types:"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),s.jsx("span",{className:"text-xs text-gray-600",children:"Meat"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),s.jsx("span",{className:"text-xs text-gray-600",children:"Dairy"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),s.jsx("span",{className:"text-xs text-gray-600",children:"Pareve"})]})]})]}),n&&s.jsx("div",{className:"absolute top-4 right-4",children:s.jsx("button",{onClick:()=>{p.current&&n&&(p.current.panTo(new window.google.maps.LatLng(n.latitude,n.longitude)),p.current.setZoom(10))},className:"bg-white/95 backdrop-blur-sm rounded-lg p-2 shadow-lg hover:bg-white transition-colors",title:"Center on your location",children:s.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})})})]}):s.jsx("div",{className:`bg-gray-100 rounded-lg flex items-center justify-center ${i}`,children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-jewgo-primary mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading interactive map..."})]})})}var u=a(86871),m=a(86255),h=a(77636),g=a(94019),x=a(76557);let p=(0,x.Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),y=(0,x.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);function b({onLocationGranted:e,onLocationDenied:t,onDismiss:a}){let[n,l]=(0,r.useState)(!1),[i,o]=(0,r.useState)(null);return s.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 border border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"bg-jewgo-primary/10 p-2 rounded-full",children:s.jsx(h.Z,{className:"h-6 w-6 text-jewgo-primary"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Enable Location Access"})]}),s.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(g.Z,{className:"h-5 w-5"})})]}),(0,s.jsxs)("div",{className:"mb-6",children:[s.jsx("p",{className:"text-gray-600 mb-4",children:"To provide you with the best experience, we'd like to access your location to:"}),(0,s.jsxs)("ul",{className:"space-y-2 text-sm text-gray-600",children:[(0,s.jsxs)("li",{className:"flex items-start space-x-2",children:[s.jsx(p,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:"Show restaurants near you"})]}),(0,s.jsxs)("li",{className:"flex items-start space-x-2",children:[s.jsx(p,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:"Calculate accurate distances"})]}),(0,s.jsxs)("li",{className:"flex items-start space-x-2",children:[s.jsx(p,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),s.jsx("span",{children:"Provide personalized recommendations"})]})]})]}),i&&s.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx(y,{className:"h-4 w-4 text-red-500"}),s.jsx("span",{className:"text-sm text-red-700",children:i})]})}),(0,s.jsxs)("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:a,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200 font-medium",children:"Not Now"}),s.jsx("button",{onClick:()=>{if(!navigator.geolocation){o("Geolocation is not supported by this browser");return}l(!0),o(null),navigator.geolocation.getCurrentPosition(t=>{l(!1),e({latitude:t.coords.latitude,longitude:t.coords.longitude})},e=>{l(!1);let a="Unable to get your location";switch(e.code){case e.PERMISSION_DENIED:a="Location access was denied. Please enable location services in your browser settings.";break;case e.POSITION_UNAVAILABLE:a="Location information is unavailable. Please try again.";break;case e.TIMEOUT:a="Location request timed out. Please try again."}o(a),t()},{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5})},disabled:n,className:"flex-1 px-4 py-3 bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-all duration-200 font-medium shadow-sm hover:shadow-md",children:n?(0,s.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),s.jsx("span",{children:"Getting Location..."})]}):"Enable Location"})]})]})})}function f(){let[e,t]=(0,r.useState)({status:"checking",message:"Checking API status...",lastChecked:null}),a=async()=>{try{t(e=>({...e,status:"checking",message:"Checking API status..."}));let e=await fetch("https://jewgo.onrender.com/health",{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(15e3)});if(e.ok){let a=await e.json();t({status:"healthy",message:`API Healthy - ${a.restaurants_count||0} restaurants available`,lastChecked:new Date})}else t({status:"unhealthy",message:`API Error - Status ${e.status}`,lastChecked:new Date})}catch(a){console.error("API health check failed:",a);let e="API Unavailable - Connection failed";a instanceof Error&&("AbortError"===a.name?e="API Timeout - Backend may be starting up":a.message.includes("Failed to fetch")&&(e="API Unreachable - Network issue")),t({status:"unhealthy",message:e,lastChecked:new Date})}};return(0,s.jsxs)("div",{className:`fixed bottom-20 right-4 z-50 px-3 py-2 rounded-lg border text-xs font-medium ${(()=>{switch(e.status){case"healthy":return"text-green-600 bg-green-50 border-green-200";case"unhealthy":return"text-red-600 bg-red-50 border-red-200";case"checking":return"text-yellow-600 bg-yellow-50 border-yellow-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}})()}`,children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{children:(()=>{switch(e.status){case"healthy":return"\uD83D\uDFE2";case"unhealthy":return"\uD83D\uDD34";case"checking":return"\uD83D\uDFE1";default:return"⚪"}})()}),s.jsx("span",{children:e.message}),s.jsx("button",{onClick:a,className:"ml-2 px-2 py-1 bg-white rounded text-xs hover:bg-gray-50 transition-colors",title:"Refresh API status",children:"\uD83D\uDD04"})]}),e.lastChecked&&(0,s.jsxs)("div",{className:"text-xs opacity-75 mt-1",children:["Last checked: ",e.lastChecked.toLocaleTimeString()]})]})}let j="https://jewgo.onrender.com";class v{static async wakeUpBackend(){try{return console.log("Attempting to wake up backend service..."),(await fetch(`${j}/`,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch(e){return console.log("Wake-up attempt failed, continuing with normal request..."),!1}}static async makeRequest(e,t={},a=3,s=15e3){let r=`${j}${e}`,n={...t,headers:{"Content-Type":"application/json",Accept:"application/json",...t.headers}};for(let t=1;t<=a;t++)try{console.log(`API request attempt ${t}/${a}: ${r}`),1===t&&e.includes("/api/restaurants")&&await this.wakeUpBackend();let l=new AbortController,i=setTimeout(()=>l.abort(),s),o=await fetch(r,{...n,signal:l.signal});if(clearTimeout(i),!o.ok){let e={message:`HTTP error! status: ${o.status}`,status:o.status,retryable:o.status>=500||429===o.status};if(404===o.status)throw e;if(e.retryable&&t<a){console.warn(`Retryable error, attempting retry ${t+1}/${a}`),await new Promise(e=>setTimeout(e,1e3*t));continue}throw e}let c=o.headers.get("content-type");if(c&&c.includes("application/json")){let e=await o.json();return console.log(`API request successful: ${r}`),e}throw Error("Invalid response format - expected JSON")}catch(e){if(console.error(`API request failed (attempt ${t}/${a}):`,e),e instanceof Error&&"AbortError"===e.name&&(console.error(`Request timed out after ${s}ms`),t===a))throw Error(`Request timed out after ${s}ms - the backend server may be down or overloaded`);if(t===a)throw e;await new Promise(e=>setTimeout(e,1e3*t))}throw Error("All retry attempts failed")}static async fetchRestaurants(e=1e3){try{let t=await this.makeRequest(`/api/restaurants?limit=${e}`),a=[],s=0;return t&&"object"==typeof t&&(Array.isArray(t)?(a=t,s=t.length):t.restaurants&&Array.isArray(t.restaurants)?(a=t.restaurants,s=t.total||t.restaurants.length):(console.warn("Unexpected API response format:",t),a=[],s=0)),{restaurants:a,total:s}}catch(e){return console.error("Failed to fetch restaurants:",e),{restaurants:[],total:0}}}static async searchRestaurants(e,t=100){try{let a=await this.makeRequest(`/api/restaurants/search?q=${encodeURIComponent(e)}&limit=${t}`);return{restaurants:a.restaurants||[],total:a.total||0}}catch(e){return console.error("Failed to search restaurants:",e),{restaurants:[],total:0}}}static async getRestaurant(e){try{let t=await this.makeRequest(`/api/restaurants/${e}`);if(!t||"object"!=typeof t)return console.error(`Invalid response format for restaurant ${e}:`,t),null;if(!t.id||!t.name)return console.error(`Invalid restaurant data for ID ${e}:`,t),null;return t}catch(t){if(404===t.status)return console.warn(`Restaurant ${e} not found`),null;return console.error(`Failed to fetch restaurant ${e}:`,t),null}}static async getStatistics(){try{return await this.makeRequest("/api/statistics")}catch(e){return console.error("Failed to fetch statistics:",e),{total_restaurants:0,total_cities:0,total_states:0}}}static getMockRestaurants(){return[{id:1,name:"Kosher Deli & Grill",address:"123 Main St",city:"Miami",state:"FL",zip_code:"33101",phone_number:"(305) 555-0123",certifying_agency:"KM",kosher_category:"meat",listing_type:"restaurant",status:"active",created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z"},{id:2,name:"Miami Kosher Market",address:"456 Oak Ave",city:"Miami Beach",state:"FL",zip_code:"33139",phone_number:"(305) 555-0456",certifying_agency:"ORB",kosher_category:"dairy",listing_type:"restaurant",status:"active",created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z"}]}}let w=e=>v.fetchRestaurants(e),N=()=>v.getMockRestaurants();function k(){(0,n.useSearchParams)();let[e,t]=(0,r.useState)([]),[a,c]=(0,r.useState)([]),[h,g]=(0,r.useState)(!0),[x,p]=(0,r.useState)(null),[y,j]=(0,r.useState)(""),[v,k]=(0,r.useState)(null),[P,A]=(0,r.useState)(null),[S,L]=(0,r.useState)(!1),[C,I]=(0,r.useState)(null),[D,R]=(0,r.useState)({}),[$,_]=(0,r.useState)(null),[E,T]=(0,r.useState)("eatery"),[q,M]=(0,r.useState)(!1),[F,U]=(0,r.useState)(!1),[Z,G]=(0,r.useState)(!1);(0,r.useCallback)(async()=>{try{g(!0),p(null),console.log("Live map fetching restaurants...");let e=await w(1e3);if(console.log("Live map restaurants fetched:",e.restaurants?.length||0),e&&e.restaurants&&Array.isArray(e.restaurants)&&e.restaurants.length>0){let a=e.restaurants.filter(e=>e&&"object"==typeof e&&e.id);a.length!==e.restaurants.length&&console.warn(`Live map filtered out ${e.restaurants.length-a.length} invalid restaurants from API response`),t(a)}else console.warn("Live map no valid restaurants received from API, using mock data"),t(N()),p("Using fallback data - API temporarily unavailable")}catch(e){console.error("Live map error fetching restaurants:",e),console.log("Live map falling back to mock data"),t(N()),p("Using fallback data - API temporarily unavailable")}finally{g(!1)}},[]);let O=e=>{switch(e){case 1:return"Location access denied. Please enable location services.";case 2:return"Location unavailable. Please try again.";case 3:return"Location request timed out. Please try again.";default:return"Unable to get your location. Please try again."}},z=()=>{j(""),R({})},H=()=>!!y.trim()||Object.values(D).some(e=>void 0!==e&&!1!==e&&""!==e);return h?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"text-gray-500",children:"Loading restaurants..."})}):x?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-red-500",children:["Error: ",x]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-neutral-50",children:[s.jsx(l.Z,{}),s.jsx("div",{className:"px-4 sm:px-6 py-4 bg-white border-b border-gray-100",children:s.jsx(i.Z,{onSearch:e=>{j(e)},onLocationSelect:e=>{_({lat:e.lat,lng:e.lng}),j(e.address)},placeholder:"Search for kosher restaurants, agencies, or locations...",showAdvancedFilters:!0,useGoogleAPI:!0})}),s.jsx("div",{className:"px-4 sm:px-6 py-2 bg-white border-b border-gray-100",children:s.jsx(m.Z,{activeTab:E,onTabChange:e=>{T(e)}})}),s.jsx("div",{className:"px-4 sm:px-6 py-3 bg-white border-b border-gray-100",children:s.jsx(o.Z,{onShowFilters:()=>{},onShowMap:()=>{},onAddEatery:()=>window.location.href="/add-eatery",onFilterChange:(e,t)=>{R(a=>({...a,[e]:t}))},onToggleFilter:(e,t)=>{R(a=>({...a,[e]:t}))},onDistanceChange:e=>{R(t=>({...t,distanceRadius:e}))},onClearAll:z,onLocationReset:()=>{console.log("Resetting location permission"),localStorage.removeItem("userLocation"),localStorage.removeItem("locationPermissionHandled"),A(null),I(null),U(!1),M(!0)},activeFilters:D,userLocation:P?{lat:P.latitude,lng:P.longitude}:null,locationLoading:S,hasActiveFilters:H(),isOnMapPage:!0})}),S&&s.jsx("div",{className:"px-4 py-2 bg-blue-50 text-blue-700 text-sm",children:"Getting your location..."}),C&&(0,s.jsxs)("div",{className:"px-4 py-2 bg-yellow-50 text-yellow-700 text-sm",children:[C,s.jsx("button",{onClick:()=>{if(!navigator.geolocation){I("Geolocation is not supported by this browser.");return}L(!0),I(null),navigator.geolocation.getCurrentPosition(e=>{A({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy}),L(!1)},e=>{I(O(e.code)),L(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},className:"ml-2 underline hover:no-underline",children:"Try again"})]}),H()&&(0,s.jsxs)("div",{className:"px-4 py-2 bg-gray-50 text-sm text-gray-600 border-b border-gray-200",children:[(()=>{let e=[];return y.trim()&&e.push(`"${y}"`),D.agency&&e.push(`${D.agency} certified`),D.dietary&&e.push(`${D.dietary} only`),D.category&&e.push(`${D.category} cuisine`),D.nearMe&&e.push(`within ${D.distanceRadius||10} miles`),D.openNow&&e.push("open now"),e.length>0?e.join(", "):"All restaurants"})()," • ",a.length," restaurants",s.jsx("button",{onClick:z,className:"ml-2 text-blue-600 hover:text-blue-800 underline",children:"Clear all"})]}),s.jsx("div",{className:"flex-1 relative",children:s.jsx(d,{restaurants:a,userLocation:P,selectedRestaurantId:v?.id,onRestaurantSelect:t=>{k(e.find(e=>e.id===t)||null)},mapCenter:$})}),s.jsx(u.Z,{}),s.jsx(f,{}),q&&s.jsx(b,{onLocationGranted:e=>{console.log("Location granted:",e),A(e),M(!1),localStorage.setItem("userLocation",JSON.stringify(e)),localStorage.setItem("locationPermissionHandled","granted")},onLocationDenied:()=>{console.log("Location denied by user"),M(!1),I("Location access denied"),localStorage.setItem("locationPermissionHandled","denied")},onDismiss:()=>{console.log("Location prompt dismissed"),M(!1),localStorage.setItem("locationPermissionHandled","dismissed")}})]})}},23245:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var s=a(19510),r=a(71159);let n=(0,a(68570).createProxy)(String.raw`/Users/mendell/jewgo app/frontend/components/LiveMapClient.tsx#default`);function l(){return s.jsx(r.Suspense,{fallback:s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsx("div",{className:"text-gray-500",children:"Loading map..."})}),children:s.jsx(n,{})})}}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[8948,2892,7377,8608,7765,5748],()=>a(76907));module.exports=s})();