(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4830],{4144:(e,t,a)=>{"use strict";a.d(t,{default:()=>j});var n=a(5155),r=a(2115),s=a(5695),o=a(7288),l=a(6395),i=a(7976),c=a(1819),d=a(9509);function u(e){let{restaurants:t,onRestaurantSelect:a,selectedRestaurantId:s,userLocation:o,mapCenter:l,className:i="h-96"}=e,[u,g]=(0,r.useState)(!1),[m,h]=(0,r.useState)(null),[p,x]=(0,r.useState)(null),y=(0,r.useRef)(null),w=(0,r.useRef)(null),f=(0,r.useRef)([]),b=(0,r.useRef)(null),v=(0,r.useRef)(null),[j,k]=(0,r.useState)(!1),N=(0,c.WD)(t,e=>{if(!e.latitude||!e.longitude)return!1;let t=parseFloat(e.latitude.toString()),a=parseFloat(e.longitude.toString());return!isNaN(t)&&!isNaN(a)});console.log("InteractiveRestaurantMap Debug:",{totalRestaurants:t.length,restaurantsWithCoords:N.length,userLocation:!!o,mapCenter:!!l}),(0,r.useEffect)(()=>{(()=>{if(window.google&&window.google.maps&&window.google.maps.LatLngBounds)return k(!0);if(document.querySelector('script[src*="maps.googleapis.com"]')){let e=setInterval(()=>{window.google&&window.google.maps&&window.google.maps.LatLngBounds&&(k(!0),clearInterval(e))},100);setTimeout(()=>{clearInterval(e),window.google&&window.google.maps||h("Google Maps API failed to load")},1e4);return}let e=document.createElement("script");e.src="https://maps.googleapis.com/maps/api/js?key=".concat(d.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY,"&libraries=places,geometry&loading=async"),e.async=!0,e.defer=!0,e.onload=()=>{let e=setInterval(()=>{window.google&&window.google.maps&&window.google.maps.LatLngBounds&&(k(!0),clearInterval(e))},100);setTimeout(()=>{clearInterval(e),window.google&&window.google.maps||h("Google Maps API failed to initialize")},1e4)},e.onerror=()=>{h("Failed to load Google Maps API")},document.head.appendChild(e)})()},[]),(0,r.useEffect)(()=>{if(j&&y.current&&!m)try{if(!window.google||!window.google.maps||!window.google.maps.LatLngBounds){console.error("Google Maps API not fully loaded"),h("Google Maps API not fully loaded");return}if(!w.current){let e=new window.google.maps.LatLngBounds,t={lat:25.7617,lng:-80.1918};o&&(t={lat:o.latitude,lng:o.longitude},e.extend(new window.google.maps.LatLng(o.latitude,o.longitude))),N.length>0&&N.forEach(t=>{void 0!==t.latitude&&void 0!==t.longitude&&e.extend(new window.google.maps.LatLng(t.latitude,t.longitude))});let a=new window.google.maps.Map(y.current,{center:t,zoom:o?14:10,mapTypeId:window.google.maps.MapTypeId.ROADMAP,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"transit",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#e3f2fd"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#e8f5e8"}]}],zoomControl:!0,mapTypeControl:!1,scaleControl:!0,streetViewControl:!1,rotateControl:!1,fullscreenControl:!0,gestureHandling:"cooperative"});w.current=a,v.current=new window.google.maps.InfoWindow({disableAutoPan:!1,maxWidth:300}),l?(a.setCenter(l),a.setZoom(16)):o?(a.setCenter({lat:o.latitude,lng:o.longitude}),a.setZoom(14)):N.length>0&&a.fitBounds(e),g(!0)}}catch(e){console.error("Error initializing map:",e),h("Failed to initialize map")}},[j,m,o,l]),(0,r.useEffect)(()=>{if(w.current&&u&&o)try{let e=w.current;b.current&&b.current.setMap(null);let t=new window.google.maps.LatLng(o.latitude,o.longitude),a={url:"data:image/svg+xml;charset=UTF-8,".concat(encodeURIComponent('\n          <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <circle cx="16" cy="16" r="8" fill="#4285F4" stroke="white" stroke-width="3"/>\n            <circle cx="16" cy="16" r="4" fill="white"/>\n            <circle cx="16" cy="16" r="12" fill="#4285F4" opacity="0.3"/>\n          </svg>\n        ')),scaledSize:new window.google.maps.Size(32,32),anchor:new window.google.maps.Point(16,16)};b.current=new window.google.maps.Marker({position:t,map:e,icon:a,title:"Your Location",zIndex:1e3}),b.current.addListener("click",()=>{if(e.panTo(t),e.setZoom(10),v.current){let t='\n            <div class="p-3 max-w-xs">\n              <div class="flex items-center space-x-2">\n                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>\n                <h3 class="font-semibold text-gray-900 text-sm">Your Location</h3>\n              </div>\n              <p class="text-gray-600 text-xs mt-1">\n                '.concat(o.latitude.toFixed(6),", ").concat(o.longitude.toFixed(6),"\n              </p>\n              ").concat(o.accuracy?'\n                <p class="text-gray-500 text-xs mt-1">\n                  Accuracy: \xb1'.concat(Math.round(o.accuracy)," meters\n                </p>\n              "):"","\n            </div>\n          ");v.current.setContent(t),v.current.open(e,b.current)}})}catch(e){console.error("Error updating user location marker:",e)}},[o,u]),(0,r.useEffect)(()=>{if(w.current&&u&&o)try{let e=w.current;console.log("Updating map center to user location:",o),e.panTo({lat:o.latitude,lng:o.longitude}),e.setZoom(14)}catch(e){console.error("Error updating map center:",e)}},[o,u]),(0,r.useEffect)(()=>{if(console.log("mapCenter prop changed:",l),console.log("mapLoaded:",u),console.log("mapInstanceRef.current:",!!w.current),!w.current||!u||!l)return void console.log("Skipping map center update - conditions not met");try{let e=w.current;console.log("Updating map center from URL parameters:",l),e.panTo(l),e.setZoom(16),console.log("Map center updated successfully")}catch(e){console.error("Error updating map center from URL parameters:",e)}},[l,u]),(0,r.useEffect)(()=>{if(w.current&&u&&0!==N.length)try{let e=w.current;f.current.forEach(e=>e.setMap(null)),f.current=[],N.forEach(t=>{let n;if(void 0===t.latitude||void 0===t.longitude)return;let r=new window.google.maps.LatLng(t.latitude,t.longitude),l=s===t.id,i=null;if(o){let e=(t.latitude-o.latitude)*Math.PI/180,a=(t.longitude-o.longitude)*Math.PI/180,n=Math.sin(e/2)*Math.sin(e/2)+Math.cos(o.latitude*Math.PI/180)*Math.cos(t.latitude*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2),r=2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n));i=3959*r}let c=(e=>{switch(null==e?void 0:e.toLowerCase()){case"meat":return"#dc2626";case"dairy":return"#2563eb";case"pareve":return"#059669";default:return"#4b5563"}})(t.kosher_category),d=l?"#FFD700":c;if(window.google.maps.marker&&window.google.maps.marker.AdvancedMarkerElement)try{let a=new window.google.maps.marker.PinElement({background:d,borderColor:"#000000",glyphColor:"#FFFFFF",scale:1.5});n=new window.google.maps.marker.AdvancedMarkerElement({position:r,map:e,content:a.element,title:t.name})}catch(s){console.warn("AdvancedMarkerElement failed, falling back to regular Marker:",s);let a={url:"data:image/svg+xml;charset=UTF-8,".concat(encodeURIComponent('\n                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                  <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" \n                        fill="'.concat(d,'" \n                        stroke="#000000" \n                        stroke-width="1.5"/>\n                  <circle cx="12" cy="9" r="2.5" fill="white"/>\n                  <circle cx="12" cy="9" r="1.5" fill="').concat(d,'"/>\n                </svg>\n              '))),scaledSize:new window.google.maps.Size(32,32),anchor:new window.google.maps.Point(12,24)};n=new window.google.maps.Marker({position:r,map:e,icon:a,title:t.name})}else{let a={url:"data:image/svg+xml;charset=UTF-8,".concat(encodeURIComponent('\n              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" \n                      fill="'.concat(d,'" \n                      stroke="#000000" \n                      stroke-width="1.5"/>\n                <circle cx="12" cy="9" r="2.5" fill="white"/>\n                <circle cx="12" cy="9" r="1.5" fill="').concat(d,'"/>\n              </svg>\n            '))),scaledSize:new window.google.maps.Size(32,32),anchor:new window.google.maps.Point(12,24)};n=new window.google.maps.Marker({position:r,map:e,icon:a,title:t.name})}n.addListener("click",()=>{if(console.log("Marker clicked:",t.name),x(t),null==a||a(t.id),v.current){let a=L(t,i);v.current.setContent(a),v.current.open(e,n)}}),f.current.push(n)})}catch(e){console.error("Error updating markers:",e)}},[N,s,u,o]);let L=(e,t)=>{let a=(e=>{var t;if(null==(t=e.image_url)?void 0:t.includes("maps.googleapis.com/maps/api/place/photo")){let t=d.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;if(t&&"YOUR_API_KEY_HERE"!==t)try{let a=new URL(e.image_url),n=a.searchParams.get("photo_reference"),r=a.searchParams.get("maxwidth")||"400";if(n)return"https://maps.googleapis.com/maps/api/place/photo?maxwidth=".concat(r,"&photo_reference=").concat(n,"&key=").concat(t)}catch(e){console.error("Error parsing Google Places URL:",e)}return null}return e.image_url})(e);return'\n      <div class="p-3 max-w-xs relative">\n        <button onclick="this.parentElement.parentElement.parentElement.close()" \n                class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 text-lg font-bold leading-none">\n          \xd7\n        </button>\n        <div class="flex items-start space-x-3">\n          '.concat(a?'\n            <img src="'.concat(a,'" alt="').concat(e.name,'" \n                 class="w-16 h-12 object-cover rounded-lg flex-shrink-0"\n                 loading="lazy" />\n          '):'\n            <div class="w-16 h-12 bg-gray-200 rounded-lg flex-shrink-0 flex items-center justify-center">\n              <span class="text-gray-400 text-xs">No Image</span>\n            </div>\n          ','\n          <div class="flex-1 min-w-0">\n            <h3 class="font-semibold text-gray-900 text-sm leading-tight mb-1">').concat(e.name,'</h3>\n            <p class="text-gray-600 text-xs mb-1">').concat(e.address,"</p>\n            ").concat(null!=t?'\n              <p class="text-blue-600 text-xs font-medium mb-1">\uD83D\uDCCD '.concat(t.toFixed(1)," miles away</p>\n            "):"","\n            ").concat(e.certifying_agency?'\n              <span class="inline-block bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full mb-1">\n                '.concat(e.certifying_agency,"\n              </span>\n            "):"","\n            ").concat(e.kosher_category?'\n              <span class="inline-block '.concat("meat"===e.kosher_category?"bg-red-50 text-red-900 border border-red-200":"dairy"===e.kosher_category?"bg-blue-50 text-blue-900 border border-blue-200":"pareve"===e.kosher_category?"bg-yellow-50 text-yellow-900 border border-yellow-200":"bg-gray-100 text-gray-800",' text-xs px-2 py-1 rounded-full mb-1">\n                ').concat(e.kosher_category,"\n              </span>\n            "):"","\n            ").concat(e.avg_price?'\n              <p class="text-green-600 text-xs font-medium">'.concat(e.avg_price,"</p>\n            "):"",'\n          </div>\n        </div>\n        <div class="mt-3 pt-2 border-t border-gray-200">\n          <a href="/restaurant/').concat(e.id,'" \n             class="text-blue-600 hover:text-blue-800 text-xs font-medium">\n            View Details →\n          </a>\n        </div>\n      </div>\n    ')};return j||m?m?(0,n.jsx)("div",{className:"bg-gray-100 rounded-lg flex items-center justify-center ".concat(i),children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-red-500 text-4xl mb-4",children:"⚠️"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Map Error"}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:m})]})}):0===N.length?(0,n.jsx)("div",{className:"bg-gray-100 rounded-lg flex items-center justify-center ".concat(i),children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"text-gray-400 text-4xl mb-4",children:"\uD83D\uDDFA️"}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No Location Data"}),(0,n.jsx)("p",{className:"text-gray-600",children:"No restaurants with location data available"})]})}):(0,n.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg overflow-hidden ".concat(i),children:[(0,n.jsx)("div",{ref:y,className:"w-full h-full"}),(0,n.jsx)("div",{className:"absolute bottom-4 left-4 bg-white/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg",children:(0,n.jsxs)("div",{className:"text-xs font-medium text-gray-700",children:[N.length," restaurants",o&&(0,n.jsx)("span",{className:"text-blue-600 ml-2",children:"\uD83D\uDCCD Your location"})]})}),(0,n.jsxs)("div",{className:"absolute top-4 left-4 bg-white/95 backdrop-blur-sm rounded-lg px-3 py-2 shadow-lg",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-gray-700 mb-2",children:"Kosher Types:"}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-red-500"}),(0,n.jsx)("span",{className:"text-xs text-gray-600",children:"Meat"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),(0,n.jsx)("span",{className:"text-xs text-gray-600",children:"Dairy"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full bg-green-500"}),(0,n.jsx)("span",{className:"text-xs text-gray-600",children:"Pareve"})]})]})]}),o&&(0,n.jsx)("div",{className:"absolute top-4 right-4",children:(0,n.jsx)("button",{onClick:()=>{w.current&&o&&(w.current.panTo(new window.google.maps.LatLng(o.latitude,o.longitude)),w.current.setZoom(10))},className:"bg-white/95 backdrop-blur-sm rounded-lg p-2 shadow-lg hover:bg-white transition-colors",title:"Center on your location",children:(0,n.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})})})]}):(0,n.jsx)("div",{className:"bg-gray-100 rounded-lg flex items-center justify-center ".concat(i),children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-jewgo-primary mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Loading interactive map..."})]})})}var g=a(4284),m=a(7242),h=a(4516),p=a(4416),x=a(9946);let y=(0,x.A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),w=(0,x.A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);function f(e){let{onLocationGranted:t,onLocationDenied:a,onDismiss:s}=e,[o,l]=(0,r.useState)(!1),[i,c]=(0,r.useState)(null);return(0,n.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full p-6 border border-gray-200",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"bg-jewgo-primary/10 p-2 rounded-full",children:(0,n.jsx)(h.A,{className:"h-6 w-6 text-jewgo-primary"})}),(0,n.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Enable Location Access"})]}),(0,n.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,n.jsx)(p.A,{className:"h-5 w-5"})})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:"To provide you with the best experience, we'd like to access your location to:"}),(0,n.jsxs)("ul",{className:"space-y-2 text-sm text-gray-600",children:[(0,n.jsxs)("li",{className:"flex items-start space-x-2",children:[(0,n.jsx)(y,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),(0,n.jsx)("span",{children:"Show restaurants near you"})]}),(0,n.jsxs)("li",{className:"flex items-start space-x-2",children:[(0,n.jsx)(y,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),(0,n.jsx)("span",{children:"Calculate accurate distances"})]}),(0,n.jsxs)("li",{className:"flex items-start space-x-2",children:[(0,n.jsx)(y,{className:"h-4 w-4 text-green-500 mt-0.5 flex-shrink-0"}),(0,n.jsx)("span",{children:"Provide personalized recommendations"})]})]})]}),i&&(0,n.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(w,{className:"h-4 w-4 text-red-500"}),(0,n.jsx)("span",{className:"text-sm text-red-700",children:i})]})}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)("button",{onClick:s,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all duration-200 font-medium",children:"Not Now"}),(0,n.jsx)("button",{onClick:()=>{if(!navigator.geolocation)return void c("Geolocation is not supported by this browser");l(!0),c(null),navigator.geolocation.getCurrentPosition(e=>{l(!1),t({latitude:e.coords.latitude,longitude:e.coords.longitude})},e=>{l(!1);let t="Unable to get your location";switch(e.code){case e.PERMISSION_DENIED:t="Location access was denied. Please enable location services in your browser settings.";break;case e.POSITION_UNAVAILABLE:t="Location information is unavailable. Please try again.";break;case e.TIMEOUT:t="Location request timed out. Please try again."}c(t),a()},{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5})},disabled:o,className:"flex-1 px-4 py-3 bg-green-500 text-white hover:bg-green-600 disabled:opacity-50 disabled:cursor-not-allowed rounded-lg transition-all duration-200 font-medium shadow-sm hover:shadow-md",children:o?(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,n.jsx)("span",{children:"Getting Location..."})]}):"Enable Location"})]})]})})}function b(){let[e,t]=(0,r.useState)({status:"checking",message:"Checking API status...",lastChecked:null}),a=async()=>{try{t(e=>({...e,status:"checking",message:"Checking API status..."}));let e=await fetch("".concat("https://jewgo.onrender.com","/health"),{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(15e3)});if(e.ok){let a=await e.json();t({status:"healthy",message:"API Healthy - ".concat(a.restaurants_count||0," restaurants available"),lastChecked:new Date})}else t({status:"unhealthy",message:"API Error - Status ".concat(e.status),lastChecked:new Date})}catch(a){console.error("API health check failed:",a);let e="API Unavailable - Connection failed";a instanceof Error&&("AbortError"===a.name?e="API Timeout - Backend may be starting up":a.message.includes("Failed to fetch")&&(e="API Unreachable - Network issue")),t({status:"unhealthy",message:e,lastChecked:new Date})}};return(0,r.useEffect)(()=>{let e=setTimeout(a,2e3),t=setInterval(a,6e4);return()=>{clearTimeout(e),clearInterval(t)}},[]),(0,n.jsxs)("div",{className:"fixed bottom-20 right-4 z-50 px-3 py-2 rounded-lg border text-xs font-medium ".concat((()=>{switch(e.status){case"healthy":return"text-green-600 bg-green-50 border-green-200";case"unhealthy":return"text-red-600 bg-red-50 border-red-200";case"checking":return"text-yellow-600 bg-yellow-50 border-yellow-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}})()),children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{children:(()=>{switch(e.status){case"healthy":return"\uD83D\uDFE2";case"unhealthy":return"\uD83D\uDD34";case"checking":return"\uD83D\uDFE1";default:return"⚪"}})()}),(0,n.jsx)("span",{children:e.message}),(0,n.jsx)("button",{onClick:a,className:"ml-2 px-2 py-1 bg-white rounded text-xs hover:bg-gray-50 transition-colors",title:"Refresh API status",children:"\uD83D\uDD04"})]}),e.lastChecked&&(0,n.jsxs)("div",{className:"text-xs opacity-75 mt-1",children:["Last checked: ",e.lastChecked.toLocaleTimeString()]})]})}var v=a(8077);function j(){let e=(0,s.useSearchParams)(),[t,a]=(0,r.useState)([]),[d,h]=(0,r.useState)([]),[p,x]=(0,r.useState)(!0),[y,w]=(0,r.useState)(null),[j,k]=(0,r.useState)(""),[N,L]=(0,r.useState)(null),[I,A]=(0,r.useState)(null),[C,M]=(0,r.useState)(!1),[P,_]=(0,r.useState)(null),[E,S]=(0,r.useState)({}),[R,T]=(0,r.useState)(null),[F,D]=(0,r.useState)("eatery"),[U,z]=(0,r.useState)(!1),[B,q]=(0,r.useState)(!1),[G,O]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let t=null==e?void 0:e.get("lat"),a=null==e?void 0:e.get("lng"),n=null==e?void 0:e.get("name");if(t&&a){let e=parseFloat(t),r=parseFloat(a);!isNaN(e)&&!isNaN(r)&&e>=-90&&e<=90&&r>=-180&&r<=180?(T({lat:e,lng:r}),n&&k(decodeURIComponent(n))):console.warn("Invalid coordinates in URL parameters:",{lat:t,lng:a,latitude:e,longitude:r})}},[e]),(0,r.useEffect)(()=>{O(!0)},[]),(0,r.useEffect)(()=>{G&&(async()=>{if(!navigator.geolocation)return console.log("Geolocation not supported");let e=localStorage.getItem("userLocation"),t=localStorage.getItem("locationPermissionHandled");I||e||t||B||(z(!0),q(!0))})()},[G,I,B]),(0,r.useEffect)(()=>{G&&H()},[G]),(0,r.useEffect)(()=>{W()},[]),(0,r.useEffect)(()=>{I&&H()},[I]),(0,r.useEffect)(()=>{console.log("Live map useEffect triggered - updateDisplayedRestaurants"),console.log("Live map allRestaurants count:",t.length),console.log("searchQuery:",j),console.log("activeFilters:",E),console.log("userLocation:",I);let e=[...t];if(j.trim()){let t=j.toLowerCase().trim();e=(0,c.WD)(e,e=>{var a,n,r,s,o,l;return!!(null==(a=e.name)?void 0:a.toLowerCase().includes(t))||!!(null==(n=e.address)?void 0:n.toLowerCase().includes(t))||!!(null==(r=e.city)?void 0:r.toLowerCase().includes(t))||!!(null==(s=e.state)?void 0:s.toLowerCase().includes(t))||!!(null==(o=e.listing_type)?void 0:o.toLowerCase().includes(t))||!!(null==(l=e.certifying_agency)?void 0:l.toLowerCase().includes(t))})}if(E.agency&&(e=(0,c.WD)(e,e=>{var t;return!!(null==(t=e.certifying_agency)?void 0:t.toLowerCase().includes(E.agency.toLowerCase()))})),E.dietary&&(e=(0,c.WD)(e,e=>{var t;let a=(null==(t=e.kosher_category)?void 0:t.toLowerCase())||"";switch(E.dietary){case"meat":return"meat"===a;case"dairy":return"dairy"===a;case"pareve":return"pareve"===a;default:return!0}})),E.category&&(e=(0,c.WD)(e,e=>{var t;return!!(null==(t=e.listing_type)?void 0:t.toLowerCase().includes(E.category.toLowerCase()))})),E.nearMe&&I){let t=E.distanceRadius||10;e=(0,c.WD)(e,e=>!!e.latitude&&!!e.longitude&&K(I.latitude,I.longitude,e.latitude,e.longitude)<=t)}if(E.openNow){let t=new Date,a=t.toLocaleDateString("en-US",{weekday:"long"}).toLowerCase(),n=60*t.getHours()+t.getMinutes();e=(0,c.WD)(e,e=>{if(!e.hours_of_operation)return!1;try{let t="string"==typeof e.hours_of_operation?JSON.parse(e.hours_of_operation):e.hours_of_operation;if(!Array.isArray(t))return!1;let r=t.find(e=>e.day===a);if(!r)return!1;let s=Y(r.open),o=Y(r.close);if(-1===s||-1===o)return!1;if(o<s)return n>=s||n<=o;return n>=s&&n<=o}catch(t){return console.error("Error parsing hours for restaurant:",e.name,t),!1}})}I&&e.sort((e,t)=>e.latitude&&e.longitude?t.latitude&&t.longitude?K(I.latitude,I.longitude,e.latitude,e.longitude)-K(I.latitude,I.longitude,t.latitude,t.longitude):-1:1),console.log("Filtered restaurants count:",e.length),h(e)},[t,j,E,I]);let H=(0,r.useCallback)(async()=>{try{var e;x(!0),w(null),console.log("Live map fetching restaurants...");let t=await (0,v.Fm)(1e3);if(console.log("Live map restaurants fetched:",(null==(e=t.restaurants)?void 0:e.length)||0),t&&t.restaurants&&Array.isArray(t.restaurants)&&t.restaurants.length>0){let e=t.restaurants.filter(e=>e&&"object"==typeof e&&e.id);e.length!==t.restaurants.length&&console.warn("Live map filtered out ".concat(t.restaurants.length-e.length," invalid restaurants from API response")),a(e)}else console.warn("Live map no valid restaurants received from API, using mock data"),a((0,v.FB)()),w("Using fallback data - API temporarily unavailable")}catch(e){console.error("Live map error fetching restaurants:",e),console.log("Live map falling back to mock data"),a((0,v.FB)()),w("Using fallback data - API temporarily unavailable")}finally{x(!1)}},[]),W=()=>{if(!navigator.geolocation)return void _("Geolocation is not supported by this browser.");M(!0),_(null),navigator.geolocation.getCurrentPosition(e=>{A({latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy}),M(!1)},e=>{_(Z(e.code)),M(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},Z=e=>{switch(e){case 1:return"Location access denied. Please enable location services.";case 2:return"Location unavailable. Please try again.";case 3:return"Location request timed out. Please try again.";default:return"Unable to get your location. Please try again."}},K=(e,t,a,n)=>{let r=(a-e)*Math.PI/180,s=(n-t)*Math.PI/180,o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(e*Math.PI/180)*Math.cos(a*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*3959},Y=e=>{let t=e.toLowerCase().trim().match(/(\d+):?(\d*)\s*(am|pm)/);if(!t)return -1;let a=parseInt(t[1]),n=t[2]?parseInt(t[2]):0,r=t[3];return"pm"===r&&12!==a&&(a+=12),"am"===r&&12===a&&(a=0),60*a+n},J=()=>{k(""),S({})},V=()=>!!j.trim()||Object.values(E).some(e=>void 0!==e&&!1!==e&&""!==e);return p?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsx)("div",{className:"text-gray-500",children:"Loading restaurants..."})}):y?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-red-500",children:["Error: ",y]})}):(0,n.jsxs)("div",{className:"min-h-screen bg-neutral-50",children:[(0,n.jsx)(o.A,{}),(0,n.jsx)("div",{className:"px-4 sm:px-6 py-4 bg-white border-b border-gray-100",children:(0,n.jsx)(l.A,{onSearch:e=>{k(e)},onLocationSelect:e=>{T({lat:e.lat,lng:e.lng}),k(e.address)},placeholder:"Search for kosher restaurants, agencies, or locations...",showAdvancedFilters:!0,useGoogleAPI:!0})}),(0,n.jsx)("div",{className:"px-4 sm:px-6 py-2 bg-white border-b border-gray-100",children:(0,n.jsx)(m.A,{activeTab:F,onTabChange:e=>{D(e)}})}),(0,n.jsx)("div",{className:"px-4 sm:px-6 py-3 bg-white border-b border-gray-100",children:(0,n.jsx)(i.A,{onShowFilters:()=>{},onShowMap:()=>{},onAddEatery:()=>window.location.href="/add-eatery",onFilterChange:(e,t)=>{S(a=>({...a,[e]:t}))},onToggleFilter:(e,t)=>{S(a=>({...a,[e]:t}))},onDistanceChange:e=>{S(t=>({...t,distanceRadius:e}))},onClearAll:J,onLocationReset:()=>{console.log("Resetting location permission"),localStorage.removeItem("userLocation"),localStorage.removeItem("locationPermissionHandled"),A(null),_(null),q(!1),z(!0)},activeFilters:E,userLocation:I?{lat:I.latitude,lng:I.longitude}:null,locationLoading:C,hasActiveFilters:V(),isOnMapPage:!0})}),C&&(0,n.jsx)("div",{className:"px-4 py-2 bg-blue-50 text-blue-700 text-sm",children:"Getting your location..."}),P&&(0,n.jsxs)("div",{className:"px-4 py-2 bg-yellow-50 text-yellow-700 text-sm",children:[P,(0,n.jsx)("button",{onClick:W,className:"ml-2 underline hover:no-underline",children:"Try again"})]}),V()&&(0,n.jsxs)("div",{className:"px-4 py-2 bg-gray-50 text-sm text-gray-600 border-b border-gray-200",children:[(()=>{let e=[];return j.trim()&&e.push('"'.concat(j,'"')),E.agency&&e.push("".concat(E.agency," certified")),E.dietary&&e.push("".concat(E.dietary," only")),E.category&&e.push("".concat(E.category," cuisine")),E.nearMe&&e.push("within ".concat(E.distanceRadius||10," miles")),E.openNow&&e.push("open now"),e.length>0?e.join(", "):"All restaurants"})()," • ",d.length," restaurants",(0,n.jsx)("button",{onClick:J,className:"ml-2 text-blue-600 hover:text-blue-800 underline",children:"Clear all"})]}),(0,n.jsx)("div",{className:"flex-1 relative",children:(0,n.jsx)(u,{restaurants:d,userLocation:I,selectedRestaurantId:null==N?void 0:N.id,onRestaurantSelect:e=>{L(t.find(t=>t.id===e)||null)},mapCenter:R})}),(0,n.jsx)(g.A,{}),(0,n.jsx)(b,{}),U&&(0,n.jsx)(f,{onLocationGranted:e=>{console.log("Location granted:",e),A(e),z(!1),localStorage.setItem("userLocation",JSON.stringify(e)),localStorage.setItem("locationPermissionHandled","granted")},onLocationDenied:()=>{console.log("Location denied by user"),z(!1),_("Location access denied"),localStorage.setItem("locationPermissionHandled","denied")},onDismiss:()=>{console.log("Location prompt dismissed"),z(!1),localStorage.setItem("locationPermissionHandled","dismissed")}})]})}},6724:(e,t,a)=>{Promise.resolve().then(a.bind(a,4144))},8077:(e,t,a)=>{"use strict";a.d(t,{FB:()=>o,Fm:()=>s});let n="https://jewgo.onrender.com";class r{static async wakeUpBackend(){try{return console.log("Attempting to wake up backend service..."),(await fetch("".concat(n,"/"),{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch(e){return console.log("Wake-up attempt failed, continuing with normal request..."),!1}}static async makeRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:15e3,s="".concat(n).concat(e),o={...t,headers:{"Content-Type":"application/json",Accept:"application/json",...t.headers}};for(let t=1;t<=a;t++)try{console.log("API request attempt ".concat(t,"/").concat(a,": ").concat(s)),1===t&&e.includes("/api/restaurants")&&await this.wakeUpBackend();let n=new AbortController,l=setTimeout(()=>n.abort(),r),i=await fetch(s,{...o,signal:n.signal});if(clearTimeout(l),!i.ok){let e={message:"HTTP error! status: ".concat(i.status),status:i.status,retryable:i.status>=500||429===i.status};if(404===i.status)throw e;if(e.retryable&&t<a){console.warn("Retryable error, attempting retry ".concat(t+1,"/").concat(a)),await new Promise(e=>setTimeout(e,1e3*t));continue}throw e}let c=i.headers.get("content-type");if(c&&c.includes("application/json")){let e=await i.json();return console.log("API request successful: ".concat(s)),e}throw Error("Invalid response format - expected JSON")}catch(e){if(console.error("API request failed (attempt ".concat(t,"/").concat(a,"):"),e),e instanceof Error&&"AbortError"===e.name&&(console.error("Request timed out after ".concat(r,"ms")),t===a))throw Error("Request timed out after ".concat(r,"ms - the backend server may be down or overloaded"));if(t===a)throw e;await new Promise(e=>setTimeout(e,1e3*t))}throw Error("All retry attempts failed")}static async fetchRestaurants(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;try{let t=await this.makeRequest("/api/restaurants?limit=".concat(e)),a=[],n=0;return t&&"object"==typeof t&&(Array.isArray(t)?(a=t,n=t.length):t.restaurants&&Array.isArray(t.restaurants)?(a=t.restaurants,n=t.total||t.restaurants.length):(console.warn("Unexpected API response format:",t),a=[],n=0)),{restaurants:a,total:n}}catch(e){return console.error("Failed to fetch restaurants:",e),{restaurants:[],total:0}}}static async searchRestaurants(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;try{let a=await this.makeRequest("/api/restaurants/search?q=".concat(encodeURIComponent(e),"&limit=").concat(t));return{restaurants:a.restaurants||[],total:a.total||0}}catch(e){return console.error("Failed to search restaurants:",e),{restaurants:[],total:0}}}static async getRestaurant(e){try{let t=await this.makeRequest("/api/restaurants/".concat(e));if(!t||"object"!=typeof t)return console.error("Invalid response format for restaurant ".concat(e,":"),t),null;if(!t.id||!t.name)return console.error("Invalid restaurant data for ID ".concat(e,":"),t),null;return t}catch(t){if(404===t.status)return console.warn("Restaurant ".concat(e," not found")),null;return console.error("Failed to fetch restaurant ".concat(e,":"),t),null}}static async getStatistics(){try{return await this.makeRequest("/api/statistics")}catch(e){return console.error("Failed to fetch statistics:",e),{total_restaurants:0,total_cities:0,total_states:0}}}static getMockRestaurants(){return[{id:1,name:"Kosher Deli & Grill",address:"123 Main St",city:"Miami",state:"FL",zip_code:"33101",phone_number:"(305) 555-0123",certifying_agency:"KM",kosher_category:"meat",listing_type:"restaurant",status:"active",created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z"},{id:2,name:"Miami Kosher Market",address:"456 Oak Ave",city:"Miami Beach",state:"FL",zip_code:"33139",phone_number:"(305) 555-0456",certifying_agency:"ORB",kosher_category:"dairy",listing_type:"restaurant",status:"active",created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z"}]}}let s=e=>r.fetchRestaurants(e),o=()=>r.getMockRestaurants()}},e=>{e.O(0,[6635,2884,2084,8441,5964,7358],()=>e(e.s=6724)),_N_E=e.O()}]);